<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Raw data manipulation</title>
  <script src="http://cdn.jsdelivr.net/alasql/latest/alasql.min.js"></script>
  <script src="./d3.min.js"></script>
  <link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>
  <h1>Raw data manipulation</h1>
  <script>
  // var data = [{
  //   "category": "Search Engines",
  //   "hits": 5,
  //   "bytes": 50189
  // }, {
  //   "category": "Content Server",
  //   "hits": 1,
  //   "bytes": 17308
  // }, {
  //   "category": "Content Server",
  //   "hits": 1,
  //   "bytes": 47412
  // }, {
  //   "category": "Search Engines",
  //   "hits": 1,
  //   "bytes": 7601
  // }, {
  //   "category": "Business",
  //   "hits": 1,
  //   "bytes": 2847
  // }, {
  //   "category": "Content Server",
  //   "hits": 1,
  //   "bytes": 24210
  // }, {
  //   "category": "Internet Services",
  //   "hits": 1,
  //   "bytes": 3690
  // }, {
  //   "category": "Search Engines",
  //   "hits": 6,
  //   "bytes": 613036
  // }, {
  //   "category": "Search Engines",
  //   "hits": 1,
  //   "bytes": 2858
  // }];

  // objArr = [{
  //   key: "Mon Sep 23 2013 00: 00: 00 GMT - 0400",
  //   val: 42
  // }, {
  //   key: "Mon Sep 24 2013 00: 00: 00 GMT - 0400",
  //   val: 78
  // }, {
  //   key: "Mon Sep 25 2013 00: 00: 00 GMT - 0400",
  //   val: 23
  // }, {
  //   key: "Mon Sep 23 2013 00: 00: 00 GMT - 0400",
  //   val: 54
  // }, {
  //   key: "Mon Sep 25 2013 00: 00: 00 GMT - 0400",
  //   val: 109
  // }, {
  //   key: "Mon Sep 25 2013 00: 00: 00 GMT - 0400",
  //   val: 80
  // }];

  // var temp = {};
  // var obj = null;

  // for (var i = 0; i < data.length; i++) {
  //   obj = data[i];

  //   if (!temp[obj.category]) {
  //     temp[obj.category] = obj;
  //   } else {
  //     temp[obj.category].bytes += obj.bytes;
  //     temp[obj.category].hits += obj.hits;
  //   }
  // }
  // var result = [];
  // debugger;

  // for (var prop in temp) {
  //   debugger;

  //   result.push(temp[prop]);
  // }

  // const col_1 = [{
  //     "category": "Search Engines",
  //     "hits": 5,
  //     "bytes": 50189
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 17308
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 47412
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 1,
  //     "bytes": 7601
  //   }, {
  //     "category": "Business",
  //     "hits": 1,
  //     "bytes": 2847
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 24210
  //   }, {
  //     "category": "Internet Services",
  //     "hits": 1,
  //     "bytes": 3690
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 6,
  //     "bytes": 613036
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 1,
  //     "bytes": 2858
  // }];

  // const col_2 = [{
  //     "category": "Search Engines",
  //     "hits": 8,
  //     "bytes": 501389
  //   }, {
  //     "category": "Content Server",
  //     "hits": 12,
  //     "bytes": 173208
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 471412
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 4,
  //     "bytes": 76301
  //   }, {
  //     "category": "Business",
  //     "hits": 9,
  //     "bytes": 284732
  //   }, {
  //     "category": "Backup Server",
  //     "hits": 11,
  //     "bytes": 22101
  //   }, {
  //     "category": "Router",
  //     "hits": 108,
  //     "bytes": 36459550
  //   }, {
  //     "category": "Router",
  //     "hits": 81,
  //     "bytes": 459550
  //   }, {
  //     "category": "CMS",
  //     "hits": 2,
  //     "bytes": 369550
  //   }, {
  //     "category": "CMS",
  //     "hits": 21,
  //     "bytes": 45659550
  //   },{
  //     "category": "Content Server",
  //     "hits": 15,
  //     "bytes": 242101
  //   }, {
  //     "category": "Internet Services",
  //     "hits": 11,
  //     "bytes": 369550
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 6,
  //     "bytes": 61036
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 9,
  //     "bytes": 28458
  // }];

  // const col_3 = [{
  //     "category": "Search Engines",
  //     "hits": 5,
  //     "bytes": 50189
  //   }, {
  //     "category": "Gaming Server",
  //     "hits": 30,
  //     "bytes": 17308
  //   }, {
  //     "category": "Content Server",
  //     "hits": 3,
  //     "bytes": 178
  //   }, {
  //     "category": "Gaming Server",
  //     "hits": 1,
  //     "bytes": 173028
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 47412
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 1,
  //     "bytes": 7601
  //   }, {
  //     "category": "Business",
  //     "hits": 1,
  //     "bytes": 2847
  //   }, {
  //     "category": "VPN",
  //     "hits": 11,
  //     "bytes": 1738
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 108
  //   }, {
  //     "category": "Content Server",
  //     "hits": 1,
  //     "bytes": 24210
  //   }, {
  //     "category": "Internet Services",
  //     "hits": 6,
  //     "bytes": 3690
  //   }, {
  //     "category": "Firebase Hosting",
  //     "hits": 12,
  //     "bytes": 525406
  //   }, {
  //     "category": "Firewall",
  //     "hits": 61,
  //     "bytes": 61036
  //   }, {
  //     "category": "Backup Server",
  //     "hits": 3,
  //     "bytes": 1540
  //   }, {
  //     "category": "Firebase Hosting",
  //     "hits": 35,
  //     "bytes": 112540
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 6,
  //     "bytes": 613036
  //   }, {
  //     "category": "VPN",
  //     "hits": 3,
  //     "bytes": 1540
  //   }, {
  //     "category": "Firebase Hosting",
  //     "hits": 35,
  //     "bytes": 112540
  //   }, {
  //     "category": "Search Engines",
  //     "hits": 1,
  //     "bytes": 2858
  // }];


var data = [
  {
    "Product": "Amarta",
    "Unit": 1,
    "Actual Sales": 10,
    "Seller": "Allen",
    "Buyer": "Emila",
    "Country": "Taipei",
    "Region": "Taiwan"
  },
  {
    "Product": "Filo Mix",
    "Unit": 2,
    "Actual Sales": 20,
    "Seller": "Bob",
    "Buyer": "Farrai",
    "Country": "Taichung",
    "Region": "Taiwan"
  },
  {
    "Product": "Geitost",
    "Unit": 3,
    "Actual Sales": 30,
    "Seller": "Candy",
    "Buyer": "Gang",
    "Country": "Taipei",
    "Region": "Taiwan"
  },
  {
    "Product": "Genen",
    "Unit": 2,
    "Actual Sales": 20,
    "Seller": "Dannel",
    "Buyer": "Farrai",
    "Country": "Hsinchu",
    "Region": "Taiwan"
  },
  {
    "Product": "Filo Mix",
    "Unit": 1,
    "Actual Sales": 10,
    "Seller": "Bob",
    "Buyer": "Helix",
    "Country": "Taichung",
    "Region": "Taiwan"
  },
  {
    "Product": "Genen",
    "Unit": 5,
    "Actual Sales": 50,
    "Seller": "Dannel",
    "Buyer": "Irving",
    "Country": "Hsinchu",
    "Region": "Taiwan"
  },
  {
    "Product": "Genen",
    "Unit": 3,
    "Actual Sales": 30,
    "Seller": "Dannel",
    "Buyer": "Gang",
    "Country": "Taipei",
    "Region": "Taiwan"
  },
  {
    "Product": "Filo Mix",
    "Unit": 2,
    "Actual Sales": 20,
    "Seller": "Bob",
    "Buyer": "Farrai",
    "Country": "Hsinchu",
    "Region": "Taiwan"
  },
  {
    "Product": "Genen",
    "Unit": 1,
    "Actual Sales": 10,
    "Seller": "Dannel",
    "Buyer": "JJ",
    "Country": "Hsinchu",
    "Region": "Taiwan"
  }
]

  function groupBy(data = [], key = '',  numberKeys = []) {
    let temp = {};
    let obj = null;
    let result = [];

    for (let i = 0; i < data.length; i++) {
      obj = Object.assign({}, data[i]);

      if (!temp[obj[key]]) {
        temp[obj[key]] = obj;
      } else {
        numberKeys.forEach((item) => {
          temp[obj[key]][item] += obj[item];
        });
      }
    }

    for (let prop in temp) {
      result.push(temp[prop]);
    }

    if (result.length === 1) {
      result[0].single = true;
    }

    return result;
  }

  // let colOne = groupBy(col_1, 'category', ['bytes', 'hits']);
  // let colTwo = groupBy(col_2, 'category', ['bytes', 'hits']);
  // let colThree = groupBy(col_3, 'category', ['bytes', 'hits']);
  // console.log(colOne);
  // console.log(colTwo);
  // console.log(colThree);

  // var arr = [colOne, colTwo, colThree];

  // console.log(arr);

  // let col_1 = groupBy(data, 'Region', ['Unit', 'Actual Sales']);
  // let col_2 = groupBy(data, 'Country', ['Unit', 'Actual Sales']);
  // let col_3 = groupBy(data, 'Buyer', ['Unit', 'Actual Sales']);

  // var arr = [col_1, col_2, col_3];
  // console.log(arr);

  var res_1 = alasql('SELECT Product as x, SUM([Unit]) as y FROM ? GROUP BY Product', [data]);
  // var res_2 = alasql('SELECT Region, Country, SUM([Actual Sales]) as num FROM ? GROUP BY Region, Country ORDER BY Country', [data]);
  // var res_3 = alasql('SELECT Region, Country, Buyer, SUM([Actual Sales]) as num FROM ? GROUP BY Region, Country, Buyer ORDER BY Region, Country', [data]);
  // var res_4 = alasql('SELECT Region, Country, Buyer, Seller, SUM([Actual Sales]) as num FROM ? GROUP BY Region, Country, Buyer, Seller ORDER BY Region, Country, Seller', [data]);


  console.log(res_1);
  // console.log(res_2);
  // console.log(res_3);
  // console.log(res_4);

  // var newArr = [res_1, res_2, res_3, res_4];
  // console.log(newArr);

  </script>
</body>

</html>
